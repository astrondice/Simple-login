<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dev-Ready Login → Dashboard (Calculator + Games)</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    :root{
      --primary: #ff6600;
      --bg: linear-gradient(#f5f7fb,#eef2f7);
      --card: #fff;
      --text: #111827;
      --muted: #6b7280;
      --radius: 12px;
      --shadow: 0 8px 30px rgba(2,6,23,.12);
      --wallpaper-opacity: 0.25;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color:var(--text);
      background: var(--bg);
      min-height:100vh;
      display:block;
    }
    /* wallpaper layer */
    .wallpaper {
      position:fixed; inset:0; z-index:-2;
      background-size:cover; background-position:center center;
      filter: blur(0px); transition: filter .25s, opacity .25s;
      opacity:var(--wallpaperOpacity, 1);
    }
    .wallpaper::after{
      content:""; position:absolute; inset:0; background: rgba(0,0,0,var(--wallpaper-overlay,0)); pointer-events:none;
    }

    /* -------- LOGIN -------- */
    #loginPage{ display:grid; place-items:center; min-height:100vh; padding:24px; }
    .login-card{
      width:360px; max-width:96vw;
      background:var(--card); border-radius:16px; padding:34px; text-align:center;
      box-shadow:var(--shadow); position:relative;
    }
    .avatar{ width:88px; height:88px; border-radius:50%; object-fit:cover; border:4px solid #fff; margin:-70px auto 10px; box-shadow:0 8px 26px rgba(0,0,0,.12); background:#eee; }
    h1{ margin:6px 0 18px; font-size:20px; }
    .input{ display:flex; align-items:center; gap:10px; border-bottom:1px solid #e6e9ef; padding:8px 6px; margin:12px 0; }
    .input i{ color:var(--muted); width:22px; text-align:center; }
    .input input{ border:0; outline:0; background:transparent; padding:8px 0; font-size:15px; width:100%; }
    .error{ color:#dc2626; min-height:18px; font-size:13px; margin-top:6px; }
    .btn{ width:100%; background:var(--primary); color:#fff; border:0; padding:12px 14px; border-radius:10px; cursor:pointer; font-weight:700; box-shadow:0 8px 24px rgba(0,0,0,.12); }
    .small { font-size:13px; color:var(--muted); margin-top:8px; }

    /* dev fab & panel */
    .dev-fab{ position:fixed; left:16px; bottom:16px; z-index:60; width:48px; height:48px; border-radius:999px; background:#111827; color:#fff; border:0; cursor:pointer; box-shadow:var(--shadow); }
    .dev-panel{ position:fixed; left:16px; bottom:80px; z-index:61; width:320px; max-width:92vw; background:var(--card); padding:14px;border-radius:12px; box-shadow:var(--shadow); display:none; }
    .dev-panel h4{ margin:0 0 8px; font-size:14px; }
    .dev-row{ margin-bottom:10px; display:grid; gap:8px; }
    .dev-row input[type=color], .dev-row input[type=file], .dev-row input[type=range] { width:100%; }

    /* -------- DASHBOARD -------- */
    #dashboardPage{ display:none; min-height:100vh; grid-template-rows:auto 1fr; }
    header.appbar{ display:flex; justify-content:space-between; align-items:center; padding:12px 18px; background:#0f1724; color:#fff; position:sticky; top:0; z-index:40; }
    .brand{ display:flex; align-items:center; gap:12px; font-weight:700; letter-spacing:.3px; }
    .logo{ width:36px; height:36px; border-radius:8px; background:var(--primary); display:grid; place-items:center; color:#fff; }
    .profile-area{ display:flex; align-items:center; gap:10px; }
    .profile-area img{ width:40px; height:40px; border-radius:50%; object-fit:cover; border:2px solid rgba(255,255,255,.08); }
    .name{ font-weight:600; }
    .menu{ position:relative; }
    .menu .btn{ background:transparent; color:#fff; border:0; font-size:20px; cursor:pointer; padding:6px; }
    .menu-sheet{ position:absolute; right:0; top:44px; min-width:200px; background:#fff; color:#111; border-radius:10px; box-shadow:var(--shadow); display:none; overflow:hidden; z-index:50; }
    .menu.open .menu-sheet{ display:block; }
    .menu-sheet a{ display:flex; gap:10px; align-items:center; padding:10px 12px; text-decoration:none; color:inherit; cursor:pointer; }
    .menu-sheet a:hover{ background:#f3f4f6; }

    main{ padding:18px; }
    #tiles{ display:grid; gap:14px; grid-template-columns: repeat(auto-fit, minmax(230px,1fr)); }
    .tile{ background:var(--card); border-radius:14px; padding:16px; box-shadow:var(--shadow); display:grid; gap:8px; cursor:pointer; }
    .t-top{ display:flex; gap:12px; align-items:center; }
    .app-icon{ width:48px; height:48px; border-radius:10px; display:grid; place-items:center; background:rgba(15,23,36,0.06); font-size:20px; color:var(--primary); overflow:hidden; }
    .tile h3{ margin:0; font-size:16px; }
    .tile p{ margin:0; color:var(--muted); font-size:13px; }

    /* sections */
    .section{ display:none; }
    .section.active{ display:block; }
    .back{ display:inline-flex; gap:8px; align-items:center; padding:8px 12px; border-radius:8px; background:#0f1724; color:#fff; border:0; cursor:pointer; margin-bottom:12px; }

    /* calculator UI */
    .calc-wrap{ max-width:420px; margin:0 auto; background:var(--card); padding:16px; border-radius:14px; box-shadow:var(--shadow); }
    #calcDisplay{ width:100%; padding:12px; font-size:20px; border-radius:10px; border:1px solid #eef2f7; text-align:right; }
    .calc-grid{ display:grid; grid-template-columns: repeat(4,1fr); gap:10px; margin-top:10px; }
    .calc-grid button{ padding:12px; border:0; border-radius:10px; background:var(--primary); color:#fff; font-weight:600; cursor:pointer; }
    .calc-grid .util{ background:#111827; }

    /* games */
    .game-wrap{ max-width:520px; margin:0 auto; background:var(--card); padding:12px; border-radius:14px; box-shadow:var(--shadow); text-align:center; }
    canvas{ background:#eef2f7; border-radius:10px; display:block; margin:12px auto; }

    /* profile modal */
    .modal{ position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.45); z-index:80; visibility:hidden; opacity:0; transition:opacity .15s; }
    .modal.open{ visibility:visible; opacity:1; }
    .modal-card{ width:360px; max-width:92vw; background:var(--card); padding:16px; border-radius:12px; box-shadow:var(--shadow); }
    .field{ display:flex; flex-direction:column; gap:6px; margin-bottom:10px; }
    .field input{ padding:10px; border-radius:8px; border:1px solid #eef2f7; }

    /* small helpers */
    .muted{ color:var(--muted); font-size:13px; }

    /* ---- NEW SNAKE GAME STYLES ---- */
    .hud {
      display: flex; gap: 10px; align-items: center; flex-wrap: wrap; justify-content: center; margin-top: 10px;
    }
    .badge {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(8px);
      border-radius: 12px;
      padding: 6px 12px;
      font-weight: 700;
      min-width: 92px;
      text-align: center;
      color: #111;
      user-select: none;
    }
    .btn {
      border: none;
      border-radius: 12px;
      background: #fff;
      color: #111;
      padding: 8px 12px;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
    }
    .btn:hover {
      filter: brightness(0.9);
    }
    .controls {
      margin-top: 12px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
      max-width: 240px;
      margin-inline: auto;
    }
    .ctrl-btn {
      background: rgba(255,255,255,0.2);
      color: #111;
      font-size: 20px;
      padding: 20px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      backdrop-filter: blur(6px);
      user-select: none;
      transition: background 0.1s ease;
    }
    .ctrl-btn:active {
      background: rgba(255,255,255,0.4);
    }
    .empty {
      visibility: hidden;
    }
  </style>
</head>
<body>

  <!-- wallpaper -->
  <div id="wall" class="wallpaper"></div>

  <!-- LOGIN -->
  <section id="loginPage">
    <div class="login-card">
      <img id="loginAvatar" class="avatar" src="https://via.placeholder.com/160" alt="avatar">
      <h1>Welcome back</h1>

      <div class="input"><i class="fa-regular fa-user"></i><input id="loginUser" placeholder="Username" autocomplete="username"></div>
      <div class="input"><i class="fa-solid fa-lock"></i><input id="loginPass" type="password" placeholder="Password" autocomplete="current-password"></div>
      <div id="loginError" class="error"></div>
      <button id="btnLogin" class="btn">Sign in</button>
      <div class="small">Default: <strong>admin</strong> / <strong>123</strong></div>
    </div>

    <!-- Dev Tools -->
    <button id="devFab" class="dev-fab" title="Dev Tools"><i class="fa-solid fa-gear"></i></button>
    <div id="devPanel" class="dev-panel" aria-hidden="true">
      <h4>Developer Tools</h4>

      <div class="dev-row">
        <label>Primary color</label>
        <input id="colorPick" type="color" value="#ff6600">
      </div>

      <div class="dev-row">
        <label>Wallpaper image</label>
        <input id="wallInput" type="file" accept="image/*">
        <label><input id="blurToggle" type="checkbox"> Blur wallpaper</label>
        <label>Overlay darkness <input id="overlayRange" type="range" min="0" max="70" value="0"></label>
      </div>

      <div class="dev-row">
        <label>Profile photo</label>
        <input id="profileInput" type="file" accept="image/*">
      </div>

      <div class="dev-row">
        <label>App icon (used for tiles)</label>
        <input id="appIconInput" type="file" accept="image/*">
      </div>

      <div class="dev-row">
        <button id="resetBtn" class="btn" style="background:#111827">Reset defaults</button>
      </div>
    </div>
  </section>

  <!-- DASHBOARD -->
  <section id="dashboardPage">
    <header class="appbar">
      <div class="brand"><div class="logo"><i class="fa-solid fa-fire"></i></div> <div>My Dashboard</div></div>
      <div class="profile-area">
        <div class="name" id="topName">Admin</div>
        <img id="topAvatar" src="https://via.placeholder.com/160" alt="pfp">
        <div class="menu" id="menuRoot">
          <button class="btn" id="menuBtn"><i class="fa-solid fa-ellipsis-vertical"></i></button>
          <div class="menu-sheet" id="menuSheet" role="menu">
            <a id="openProfile"><i class="fa-solid fa-user"></i> <span>Edit profile</span></a>
            <a id="changeLogin"><i class="fa-solid fa-user-pen"></i> <span>Change username / password</span></a>
            <a id="menuLogout"><i class="fa-solid fa-right-from-bracket"></i> <span>Logout</span></a>
          </div>
        </div>
      </div>
    </header>

    <main>
      <div id="tiles">
        <div class="tile" id="tileSnake">
          <div class="t-top"><div class="app-icon" id="iconSnake"><i class="fa-solid fa-gamepad"></i></div><div><h3>Snake</h3><p class="muted">Classic grid game</p></div></div>
        </div>

        <div class="tile" id="tileTic">
          <div class="t-top"><div class="app-icon" id="iconTic"><i class="fa-solid fa-chess-queen"></i></div><div><h3>Tic-Tac-Toe</h3><p class="muted">Play vs local player</p></div></div>
        </div>

        <div class="tile" id="tileCalc">
          <div class="t-top"><div class="app-icon" id="iconCalc"><i class="fa-solid fa-calculator"></i></div><div><h3>Calculator</h3><p class="muted">Open calculator</p></div></div>
        </div>
      </div>

      <!-- SNAKE SECTION -->
      <section id="snakeSection" class="section">
        <button class="back" data-back><i class="fa-solid fa-arrow-left"></i> Back</button>
        <div class="game-wrap">
          <h2>Snake</h2>
          <canvas id="snakeCanvas" width="480" height="480"></canvas>
          <div class="hud">
            <div class="badge" id="score">Score: 0</div>
            <div class="badge" id="level">Level: 1</div>
            <div class="badge" id="best">Best: 0</div>
            <button class="btn" id="toggle">Start</button>
          </div>
          <p class="help">Use arrows below or keyboard • Tap Start/Pause</p>
          <div class="controls">
            <div class="empty"></div>
            <button class="ctrl-btn" data-dir="up">⬆️</button>
            <div class="empty"></div>
            <button class="ctrl-btn" data-dir="left">⬅️</button>
            <button class="ctrl-btn" data-dir="down">⬇️</button>
            <button class="ctrl-btn" data-dir="right">➡️</button>
          </div>
        </div>
      </section>

      <!-- TIC TAC TOE SECTION -->
      <section id="ticSection" class="section">
        <button class="back" data-back><i class="fa-solid fa-arrow-left"></i> Back</button>
        <div class="game-wrap">
          <h2>Tic-Tac-Toe</h2>
          <div id="ticBoard" style="display:grid; grid-template-columns:repeat(3,100px); gap:8px; justify-content:center; margin:14px 0;"></div>
          <div class="muted" id="ticStatus"></div>
          <div style="margin-top:12px;"><button id="restartTic" class="btn">Restart</button></div>
        </div>
      </section>

      <!-- CALCULATOR SECTION -->
      <section id="calcSection" class="section">
        <button class="back" data-back><i class="fa-solid fa-arrow-left"></i> Back</button>
        <div class="calc-wrap">
          <h2>Calculator</h2>
          <input id="calcDisplay" type="text" readonly />
          <div class="calc-grid" style="margin-top:12px;">
            <button class="util" data-val="C">C</button>
            <button class="util" data-val="DEL">DEL</button>
            <button data-val="/">÷</button>
            <button data-val="*">×</button>

            <button data-val="7">7</button>
            <button data-val="8">8</button>
            <button data-val="9">9</button>
            <button data-val="-">-</button>

            <button data-val="4">4</button>
            <button data-val="5">5</button>
            <button data-val="6">6</button>
            <button data-val="+">+</button>

            <button data-val="1">1</button>
            <button data-val="2">2</button>
            <button data-val="3">3</button>
            <button class="util" data-val="=">=</button>

            <button style="grid-column:span 2" data-val="0">0</button>
            <button data-val=".">.</button>
            <div></div>
          </div>
        </div>
      </section>
    </main>
  </section>

  <!-- PROFILE MODAL -->
  <div id="profileModal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <h3>Edit Profile</h3>
      <div class="field"><label>Display name</label><input id="profileName"></div>
      <div class="field"><label>Profile photo</label><input id="profilePhotoFile" type="file" accept="image/*"></div>
      <div style="display:flex; gap:8px; justify-content:flex-end;">
        <button id="closeProfile" class="btn" style="background:#111827">Cancel</button>
        <button id="saveProfile" class="btn">Save</button>
      </div>
    </div>
  </div>

  <!-- CHANGE LOGIN MODAL -->
  <div id="loginModal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <h3>Change Login</h3>
      <div class="field"><label>New username</label><input id="newLoginUser"></div>
      <div class="field"><label>New password</label><input id="newLoginPass" type="password"></div>
      <div style="display:flex; gap:8px; justify-content:flex-end;">
        <button id="closeLoginModal" class="btn" style="background:#111827">Cancel</button>
        <button id="saveLoginModal" class="btn">Save</button>
      </div>
    </div>
  </div>

<script>
  // small helpers
  const $ = (s, root=document) => root.querySelector(s);
  const $$ = (s, root=document) => [...root.querySelectorAll(s)];

  // local storage wrapper for app data
  const DB = {
    key: 'devMiniApp_v1',
    read(){ try { return JSON.parse(localStorage.getItem(this.key)) || {}; } catch { return {}; } },
    write(obj){ localStorage.setItem(this.key, JSON.stringify(obj)); },
    get(k, fallback){ const d=this.read(); return (d[k]===undefined?fallback:d[k]); },
    set(k,v){ const d=this.read(); d[k]=v; this.write(d); }
  };

  // DOM refs
  const loginPage = $('#loginPage'), dashboardPage = $('#dashboardPage');
  const btnLogin = $('#btnLogin'), loginUser = $('#loginUser'), loginPass = $('#loginPass'), loginError = $('#loginError');
  const loginAvatar = $('#loginAvatar'), topAvatar = $('#topAvatar'), topName = $('#topName');
  const devFab = $('#devFab'), devPanel = $('#devPanel'), colorPick = $('#colorPick'), wallInput = $('#wallInput'), profileInput = $('#profileInput'), appIconInput = $('#appIconInput'), resetBtn = $('#resetBtn'), wallEl = $('#wall'), blurToggle = $('#blurToggle'), overlayRange = $('#overlayRange');
  const tiles = $('#tiles'), tileSnake = $('#tileSnake'), tileTic = $('#tileTic'), tileCalc = $('#tileCalc');
  const sections = $$('.section');
  const backBtns = $$('[data-back]');
  const menuRoot = $('#menuRoot'), menuBtn = $('#menuBtn'), menuSheet = $('#menuSheet');
  const profileModal = $('#profileModal'), closeProfile = $('#closeProfile'), saveProfile = $('#saveProfile'), profileName = $('#profileName'), profilePhotoFile = $('#profilePhotoFile');
  const loginModal = $('#loginModal'), closeLoginModal = $('#closeLoginModal'), saveLoginModal = $('#saveLoginModal'), newLoginUser = $('#newLoginUser'), newLoginPass = $('#newLoginPass');

  // init defaults
  const DEFAULT_USER = 'admin', DEFAULT_PASS = '123';
  if(DB.get('loginUser') === undefined) DB.set('loginUser', DEFAULT_USER);
  if(DB.get('loginPass') === undefined) DB.set('loginPass', DEFAULT_PASS);

  // apply branding if present
  function applyBranding(){
    const primary = DB.get('primary', '#ff6600'); document.documentElement.style.setProperty('--primary', primary);
    colorPick.value = primary;
    const wall = DB.get('wall', null);
    if(wall){ wallEl.style.backgroundImage = `url(${wall})`; wallEl.style.opacity = DB.get('wallOpacity', 1); }
    else { wallEl.style.backgroundImage = ''; }
    if(DB.get('avatar')){ loginAvatar.src = DB.get('avatar'); topAvatar.src = DB.get('avatar'); }
    topName.textContent = DB.get('displayName', DB.get('loginUser', DEFAULT_USER));
    // app icon apply
    const icon = DB.get('appIcon', null);
    if(icon){
      $('#iconSnake').style.backgroundImage = `url(${icon})`; $('#iconSnake').style.backgroundSize = 'cover';
      $('#iconTic').style.backgroundImage = `url(${icon})`; $('#iconTic').style.backgroundSize = 'cover';
      $('#iconCalc').style.backgroundImage = `url(${icon})`; $('#iconCalc').style.backgroundSize = 'cover';
      // hide inner <i> icons
      $$('#iconSnake i, #iconTic i, #iconCalc i').forEach(i=>i.style.opacity=0);
    }
    // wallpaper blur and overlay
    if(DB.get('wallBlur')) wallEl.style.filter = 'blur(6px)'; else wallEl.style.filter = 'blur(0px)';
    const overlay = DB.get('wallOverlay') || 0; document.documentElement.style.setProperty('--wallpaper-overlay', overlay/100);
  }
  applyBranding();

  // dev panel interactions
  devFab.addEventListener('click', ()=> devPanel.style.display = devPanel.style.display === 'block' ? 'none' : 'block');
  document.addEventListener('click', e=>{ if(!devPanel.contains(e.target) && e.target !== devFab) devPanel.style.display = 'none'; });

  colorPick.addEventListener('input', e=>{ DB.set('primary', e.target.value); document.documentElement.style.setProperty('--primary', e.target.value); });
  blurToggle.addEventListener('change', e=>{ DB.set('wallBlur', e.target.checked); applyBranding(); });
  overlayRange.addEventListener('input', e=>{ DB.set('wallOverlay', e.target.value); applyBranding(); });

    // file to base64
  function fileToBase64(file){ return new Promise((res,rej)=>{ const r = new FileReader(); r.onload = ()=>res(r.result); r.onerror = rej; r.readAsDataURL(file); }); }

  wallInput.addEventListener('change', async (e)=>{
    const f = e.target.files[0]; if(!f) return;
    const data = await fileToBase64(f);
    DB.set('wall', data); DB.set('wallOpacity', 1); applyBranding();
  });
  profileInput.addEventListener('change', async (e)=>{
    const f = e.target.files[0]; if(!f) return;
    const data = await fileToBase64(f);
    DB.set('avatar', data); loginAvatar.src = data; topAvatar.src = data;
  });
  appIconInput.addEventListener('change', async (e)=>{
    const f = e.target.files[0]; if(!f) return;
    const data = await fileToBase64(f);
    DB.set('appIcon', data); applyBranding();
  });
  resetBtn.addEventListener('click', ()=>{
    localStorage.removeItem(DB.key); location.reload();
  });

  // ---------- AUTH ----------
  function showLoginError(msg){ loginError.textContent = msg || ''; }
  function tryLogin(){
    const u = loginUser.value.trim(), p = loginPass.value;
    if(!u || !p){ showLoginError('Enter username & password'); return; }
    const savedU = DB.get('loginUser', DEFAULT_USER), savedP = DB.get('loginPass', DEFAULT_PASS);
    if(u === savedU && p === savedP){
      DB.set('loggedIn', true); DB.set('displayName', DB.get('displayName', savedU));
      goDashboard(u);
    } else {
      showLoginError('Invalid username or password');
    }
  }
  btnLogin.addEventListener('click', tryLogin);
  [loginUser, loginPass].forEach(el => el.addEventListener('keydown', e=>{ if(e.key==='Enter') tryLogin(); }));

  // auto auto-login?
  if(DB.get('loggedIn')) goDashboard(DB.get('loginUser', DEFAULT_USER));

  // navigation and UI control
  function goDashboard(name){
    loginPage.style.display = 'none'; dashboardPage.style.display = 'block';
    topName.textContent = DB.get('displayName', name || DB.get('loginUser', DEFAULT_USER));
    if(DB.get('avatar')){ topAvatar.src = DB.get('avatar'); loginAvatar.src = DB.get('avatar'); }
    applyBranding();
    showTiles();
  }

  function showTiles(){
    tiles.style.display = 'grid';
    sections.forEach(s=>s.classList.remove('active'));
  }

  // tile clicks to open sections
  tileSnake.addEventListener('click', ()=> openSection('snakeSection'));
  tileTic.addEventListener('click', ()=> openSection('ticSection'));
  tileCalc.addEventListener('click', ()=> openSection('calcSection'));

  function openSection(id){
    tiles.style.display = 'none';
    sections.forEach(s=>{
      s.classList.toggle('active', s.id === id);
    });
  }
  backBtns.forEach(b=>b.addEventListener('click', ()=>{
    showTiles();
  }));

  // menu dropdown toggle
  menuBtn.addEventListener('click', ()=> menuRoot.classList.toggle('open'));
  document.addEventListener('click', e=>{
    if(!menuRoot.contains(e.target) && e.target !== menuBtn) menuRoot.classList.remove('open');
  });

  // profile modal open/close
  $('#openProfile').addEventListener('click', ()=>{
    menuRoot.classList.remove('open');
    profileModal.classList.add('open');
    profileName.value = DB.get('displayName', DB.get('loginUser'));
    profileModal.setAttribute('aria-hidden', 'false');
  });
  closeProfile.addEventListener('click', ()=>{
    profileModal.classList.remove('open');
    profileModal.setAttribute('aria-hidden', 'true');
  });
  saveProfile.addEventListener('click', ()=>{
    const name = profileName.value.trim() || DB.get('loginUser');
    DB.set('displayName', name);
    topName.textContent = name;
    profileModal.classList.remove('open');
    profileModal.setAttribute('aria-hidden', 'true');
  });

  // login change modal open/close
  $('#changeLogin').addEventListener('click', ()=>{
    menuRoot.classList.remove('open');
    loginModal.classList.add('open');
    newLoginUser.value = DB.get('loginUser');
    newLoginPass.value = '';
    loginModal.setAttribute('aria-hidden', 'false');
  });
  closeLoginModal.addEventListener('click', ()=>{
    loginModal.classList.remove('open');
    loginModal.setAttribute('aria-hidden', 'true');
  });
  saveLoginModal.addEventListener('click', ()=>{
    const nu = newLoginUser.value.trim();
    const np = newLoginPass.value;
    if(!nu || !np) return alert('Enter both username & password');
    DB.set('loginUser', nu);
    DB.set('loginPass', np);
    alert('Login credentials updated. Please log in again.');
    DB.set('loggedIn', false);
    location.reload();
  });

  // Calculator app logic
  const calcDisplay = $('#calcDisplay');
  const calcButtons = $$('.calc-grid button');
  let calcExpr = '';
  calcButtons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const val = btn.dataset.val;
      if(val==='C'){
        calcExpr = '';
      } else if(val==='DEL'){
        calcExpr = calcExpr.slice(0,-1);
      } else if(val==='='){
        try {
          // eslint-disable-next-line no-eval
          const res = eval(calcExpr);
          calcExpr = String(res);
        } catch {
          alert('Invalid expression');
          calcExpr = '';
        }
      } else{
        calcExpr += val;
      }
      calcDisplay.value = calcExpr;
    });
  });

  // Tic-Tac-Toe simplified logic placeholder
  const ticBoard = $('#ticBoard');
  const ticStatus = $('#ticStatus');
  const restartTic = $('#restartTic');
  let ticTurn = 'X';
  let ticCells = Array(9).fill('');
  function checkWinner(board, player){
    const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    return wins.some(line => line.every(i=>board[i]===player));
  }
  function ticDraw(){ return ticCells.every(c=>c!==''); }
  function renderTic(){
    ticBoard.innerHTML = '';
    ticCells.forEach((val,i)=>{
      const cell = document.createElement('button');
      cell.textContent = val;
      cell.style.fontSize = '48px';
      cell.style.padding = '5px';
      cell.style.cursor = val === '' ? 'pointer' : 'default';
      cell.disabled = val !== '';
      cell.addEventListener('click', () => {
        if(val !== '') return;
        ticCells[i] = ticTurn;
        if(checkWinner(ticCells, ticTurn)){
          ticStatus.textContent = ticTurn + ' wins!';
          ticBoard.querySelectorAll('button').forEach(b=>b.disabled=true);
        } else if(ticDraw()){
          ticStatus.textContent = 'Draw!';
        } else {
          ticTurn = ticTurn === 'X' ? 'O' : 'X';
          ticStatus.textContent = ticTurn + "'s turn";
        }
        renderTic();
      });
      ticBoard.appendChild(cell);
    });
  }
  restartTic.addEventListener('click', ()=>{
    ticCells = Array(9).fill('');
    ticTurn = 'X';
    ticStatus.textContent = ticTurn + "'s turn";
    renderTic();
  });
  renderTic();

  // --- NEW SNAKE GAME CODE ---
  (() => {
    const cvs = document.getElementById('snakeCanvas'), ctx = cvs.getContext('2d');
    const scoreEl = document.getElementById('score'), bestEl = document.getElementById('best'),
      btn = document.getElementById('toggle'), levelEl = document.getElementById('level');

    const GRID = 20, CELL = cvs.width / GRID;
    let snake, dir, nextDir, food, running = false, gameOver = false, lastTime = 0, acc = 0, level = 1, speed = 8;
    let best = +localStorage.getItem('snakeBest') || 0;
    bestEl.textContent = "Best: " + best;
    const fruits = ["🍎", "🍌", "🍒", "🍇", "🍊", "🍉"];

    function reset() {
      snake = [{ x: 12, y: 12 }, { x: 11, y: 12 }, { x: 10, y: 12 }];
      dir = { x: 1, y: 0 }; nextDir = { ...dir };
      food = randFood();
      scoreEl.dataset.val = 0; scoreEl.textContent = "Score: 0";
      level = 1; speed = 8; levelEl.textContent = "Level: 1";
      gameOver = false;
      running = false;
      btn.textContent = "Start";
      draw();
    }
    function randFood() {
      return { x: Math.floor(Math.random() * GRID), y: Math.floor(Math.random() * GRID), icon: fruits[Math.floor(Math.random() * fruits.length)] };
    }
    function scoreUp() {
      let s = (+scoreEl.dataset.val) + 1; scoreEl.dataset.val = s; scoreEl.textContent = "Score: " + s;
      if (s % 5 === 0) { level++; speed += 2; levelEl.textContent = "Level: " + level; } // level up every 5 points
      if (s > best) { best = s; bestEl.textContent = "Best: " + best; localStorage.setItem('snakeBest', best); }
    }
    function loop(ts) {
      if (!running) { draw(); return; }
      let dt = (ts - lastTime) / 1000; lastTime = ts; acc += dt;
      let step = 1 / speed;
      while (acc >= step) { stepOnce(); acc -= step; }
      draw(); requestAnimationFrame(loop);
    }
    function stepOnce() {
      dir = nextDir;
      const head = { x: (snake[0].x + dir.x + GRID) % GRID, y: (snake[0].y + dir.y + GRID) % GRID };
      if (snake.some(s => s.x === head.x && s.y === head.y)) {
        running = false; gameOver = true; btn.textContent = "Restart"; return;
      }
      snake.unshift(head);
      if (head.x === food.x && head.y === food.y) { scoreUp(); food = randFood(); } else { snake.pop(); }
    }
    function draw() {
      ctx.fillStyle = "rgba(0,0,0,.9)"; ctx.fillRect(0, 0, cvs.width, cvs.height);
      // food
      ctx.font = `${CELL * 0.8}px serif`; ctx.textAlign = "center"; ctx.textBaseline = "middle";
      ctx.fillText(food.icon, (food.x + 0.5) * CELL, (food.y + 0.5) * CELL);
      // snake
      snake.forEach((s, i) => {
        const grad = ctx.createLinearGradient(s.x * CELL, s.y * CELL, (s.x + 1) * CELL, (s.y + 1) * CELL);
        grad.addColorStop(0, "#0ff"); grad.addColorStop(1, "#0aa");
        ctx.fillStyle = grad; ctx.shadowColor = "#0ff"; ctx.shadowBlur = 10;
        ctx.beginPath(); ctx.roundRect(s.x * CELL + 2, s.y * CELL + 2, CELL - 4, CELL - 4, 8); ctx.fill(); ctx.shadowBlur = 0;
      });
      if (!running) {
        ctx.fillStyle = "rgba(0,0,0,.5)"; ctx.fillRect(0, 0, cvs.width, cvs.height);
        ctx.fillStyle = "#fff"; ctx.font = "bold 22px system-ui"; ctx.textAlign = "center"; ctx.textBaseline = "middle";
        ctx.fillText(gameOver ? "Game Over" : "Paused", cvs.width / 2, cvs.height / 2);
      }
    }
    function setDir(nx, ny) { if (nx === -dir.x && ny === -dir.y) return; nextDir = { x: nx, y: ny }; }

    window.addEventListener("keydown", e => {
      if (e.key === "ArrowUp") setDir(0, -1);
      if (e.key === "ArrowDown") setDir(0, 1);
      if (e.key === "ArrowLeft") setDir(-1, 0);
      if (e.key === "ArrowRight") setDir(1, 0);
      if (e.key === " ") { toggle(); }
      if (e.key === "Enter" && gameOver) { start(); }
    });

    function toggle() {
      if (gameOver) return;
      running = !running; btn.textContent = running ? "Pause" : "Start"; lastTime = performance.now();
      if (running) requestAnimationFrame(loop);
      else draw();
    }
    function start() {
      reset();
      running = true;
      btn.textContent = "Pause";
      lastTime = performance.now();
      requestAnimationFrame(loop);
    }
    btn.onclick = () => gameOver ? start() : toggle();

    // on-screen controls
    document.querySelectorAll(".ctrl-btn").forEach(b => b.addEventListener("click", () => {
      const d = b.dataset.dir;
      if (d === "up") setDir(0, -1);
      if (d === "down") setDir(0, 1);
      if (d === "left") setDir(-1, 0);
      if (d === "right") setDir(1, 0);
    }));

    reset(); draw();
  })();

</script>
</body>
</html>
